# ๐ง DevSecOps Lab โ ะะพะปะฝะฐั ะัะฐะบัะธะบะฐ (ะะดะฝะฐ ะะ, Namespace, DHCP, NAT, Backup)

### ะะตััะธั: Ubuntu 25.10 (Desktop / VMware NAT)
**ะะฒัะพั:** 159NoScam 
**ะะฐะฟัะฐะฒะปะตะฝะธะต ัะฐะทะฒะธัะธั:** DevSecOps / ะะฒัะพะผะฐัะธะทะฐัะธั ะธะฝััะฐััััะบัััั  
**ะะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั:** ะะบััะฑัั 2025  

---

## ๐ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะญัะพั ะฟัะพะตะบั โ ะฟะพะปะฝะพัะตะฝะฝะฐั ะปะฐะฑะพัะฐัะพัะธั **DevSecOps-ะฟัะฐะบัะธะบะธ**, ัะตะฐะปะธะทะพะฒะฐะฝะฝะฐั **ะฒะฝัััะธ ะพะดะฝะพะน ะฒะธัััะฐะปัะฝะพะน ะผะฐัะธะฝั** (Ubuntu 25.10).  
ะ ะฝะตะน ัะธะผัะปะธััะตััั ะผะธะฝะธ-ะธะฝััะฐััััะบัััะฐ, ะฒะบะปััะฐััะฐั:

- ะธะทะพะปะธัะพะฒะฐะฝะฝัะต ัะตัะตะฒัะต ะฟัะพัััะฐะฝััะฒะฐ (`namespace`),
- DHCP-ัะตัะฒะตั ะธ NAT-ะผะฐัััััะธะทะฐัะธั,
- ัะธััะตะผะฝัะน firewall ะฝะฐ `iptables`,
- ะฑะตะทะพะฟะฐัะฝะพะต ะฟะพะดะบะปััะตะฝะธะต ะฟะพ SSH-ะบะปััะฐะผ,
- ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต ัะตัะตะท `rsync` ะธ `cron`,
- ะฐััะธะฒะธัะพะฒะฐะฝะธะต ะปะพะณะพะฒ ัะตัะตะท `tar`.

ะฆะตะปั ะฟัะพะตะบัะฐ โ ะพััะฐะฑะพัะฐัั ะฝะฐ ะฟัะฐะบัะธะบะต ะฝะฐะฒัะบะธ **DevOps + Security**, ะฟะพะปะฝะพัััั ะฝะฐ ะปะพะบะฐะปัะฝะพะน ะผะฐัะธะฝะต.

---

## ๐งฉ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ       ะัะฝะพะฒะฝะฐั ะะ         โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ Namespace: vm2        โ โ
โ โ  - ะะฝัะตััะตะนั veth1    โ โ
โ โ  - DHCP IP            โ โ
โ โ  - SSH โ ะัะฝะพะฒะฝะฐั ะะ  โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                           โ
โ veth0 <--> veth1 (ัะฒัะทะบะฐ) โ
โ DHCP + NAT + Firewall     โ
โ NGINX + Backups (/backups)โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะฝะพะฒะฝะฐั ะะ** โ ะฒัะฟะพะปะฝัะตั ัะพะปั ัะพััะฐ (DHCP, NAT, Firewall, Nginx, ััะฐะฝะธะปะธัะต ะฑัะบะฐะฟะพะฒ).  
**Namespace vm2** โ ัะผัะปะธััะตั ะฒัะพััั ะะ (ัะธััะตะผะฐ-ะบะปะธะตะฝั, ะบะพัะพัะฐั ะดะตะปะฐะตั ะฑัะบะฐะฟั ะธ ะฟะพะดะบะปััะฐะตััั ะฟะพ SSH).

---

## โ๏ธ ะัะฝะพะฒะฝัะต ะบะพะผะฟะพะฝะตะฝัั

### ๐น ะกะตัั ะธ DHCP
- ะกะพะทะดะฐะฝะธะต ะฟะฐัั ะธะฝัะตััะตะนัะพะฒ `veth0` ะธ `veth1` ะดะปั ัะฒัะทะธ ะผะตะถะดั ะพัะฝะพะฒะฝัะผ ะฟัะพัััะฐะฝััะฒะพะผ ะธ namespace.  
- DHCP-ัะตัะฒะตั (`isc-dhcp-server`) ัะฐะทะดะฐัั IP-ะฐะดัะตัะฐ ะฒ ะฟะพะดัะตัะธ `192.168.50.0/24`.  
- NAT ัะตัะตะท `iptables` ะฟะพะทะฒะพะปัะตั namespace ะฒััะพะดะธัั ะฒ ะะฝัะตัะฝะตั ัะตัะตะท ะธะฝัะตััะตะนั ะพัะฝะพะฒะฝะพะน ะะ.  

### ๐น ะะตะทะพะฟะฐัะฝะพััั ะธ Firewall
- ะะตะฐะปะธะทะพะฒะฐะฝ ัะตัะตะท `iptables` (ะฑะตะท ะธัะฟะพะปัะทะพะฒะฐะฝะธั `ufw`).  
- ะะพะปะธัะธะบะฐ ะฟะพ ัะผะพะปัะฐะฝะธั โ `INPUT DROP`, ัะฐะทัะตัะตะฝะพ ัะพะปัะบะพ:
  - ะะพะบะฐะปัะฝัะน ััะฐัะธะบ (`lo`),
  - ะฃััะฐะฝะพะฒะปะตะฝะฝัะต ัะพะตะดะธะฝะตะฝะธั (`ESTABLISHED, RELATED`),
  - ะะพััั `22` (SSH) ะธ `80` (HTTP).  
- ะะฐัััะพะนะบะธ ัะพััะฐะฝััััั ัะตัะตะท `netfilter-persistent`.  

### ๐น SSH-ะดะพัััะฟ
- ะ `vm2` ัะพะทะดะฐัััั ะฟะฐัะฐ SSH-ะบะปััะตะน (`ed25519`).  
- ะัะฑะปะธัะฝัะน ะบะปัั ะบะพะฟะธััะตััั ะฝะฐ ะพัะฝะพะฒะฝัั ะะ.  
- ะะพัะปะต ััะพะณะพ `vm2` ะผะพะถะตั ะฟะพะดะบะปััะฐัััั ะบ `192.168.50.1` ะฑะตะท ะฟะฐัะพะปั.  
- ะัะฟะพะปัะทัะตััั ะดะปั ะฟะตัะตะดะฐัะธ ะดะฐะฝะฝัั ะฟัะธ ะฑัะบะฐะฟะต.  

### ๐น ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต (rsync)
- ะัะฟะพะปัะทัะตััั `rsync` ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ `/etc/` ะธะท `vm2` ะฝะฐ ะพัะฝะพะฒะฝัั ะะ.  
- ะะตัะตะดะฐัะฐ ะธะดัั ะฟะพ SSH, ะธัะฟะพะปัะทัั ัะฐะฝะตะต ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน ะบะปัั.  
- ะะฐัะฐะปะพะณ ะดะปั ะฑัะบะฐะฟะพะฒ: `/backups/etc`.  
- ะะฐะฑะพัะฐะตั ะธะฝะบัะตะผะตะฝัะฝะพ โ ะบะพะฟะธัััััั ัะพะปัะบะพ ะธะทะผะตะฝะตะฝะธั, ััะพ ัะบะพะฝะพะผะธั ะฒัะตะผั ะธ ััะฐัะธะบ.  

### ๐น ะะฒัะพะผะฐัะธะทะฐัะธั ัะตัะตะท cron
- ะะฐัััะฐะธะฒะฐะตััั cron-ะทะฐะดะฐัะฐ, ะบะพัะพัะฐั **ะบะฐะถะดัะน ะดะตะฝั ะฒ 2:00 ะฝะพัะธ** ะฒัะฟะพะปะฝัะตั ัะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต.  
- ะะพะณะธ ะฒัะฟะพะปะฝะตะฝะธั ะฟะธััััั ะฒ `/var/log/backup-rsync.log`.  
- ะะพะผะฐะฝะดะฐ ะทะฐะฟััะบะฐะตััั ั ะฟัะฐะฒะฐะผะธ `root` ัะตัะตะท `sudo crontab -e`.  

### ๐น ะััะธะฒะธัะพะฒะฐะฝะธะต ะปะพะณะพะฒ (tar)
- ะะถะตะดะฝะตะฒะฝะพ ะฐััะธะฒะธัััััั ัะธััะตะผะฝัะต ะปะพะณะธ ะธะท `/var/log` ะฒ ะบะฐัะฐะปะพะณ `/backups/logs/`.  
- ะััะธะฒั ะธะผะตะฝััััั ะฟะพ ะดะฐัะต, ะฝะฐะฟัะธะผะตั:
  ```
  /backups/logs/logs_2025-10-20.tar.gz
  ```

---

## ๐ ะกัััะบัััะฐ ะบะฐัะฐะปะพะณะพะฒ

```
/backups/
โโโ etc/              # ะะพะฝัะธะณััะฐัะธะพะฝะฝัะต ะฑัะบะฐะฟั
โโโ logs/             # ะััะธะฒั ะปะพะณะพะฒ (tar.gz)
โโโ backup-rsync.log  # ะะพะณ ะฒัะฟะพะปะฝะตะฝะธั rsync
```

---

## ๐ ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั ะดะปั ะฟัะพะฒะตัะบะธ

```bash
# ะัะพะฒะตัะบะฐ IP ะฒะฝัััะธ namespace
sudo ip netns exec vm2 ip a

# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฐ ะฒ ะธะฝัะตัะฝะตั
sudo ip netns exec vm2 ping -c 3 8.8.8.8

# ะัะพะฒะตัะบะฐ nginx ะธ ssh ะฝะฐ ะพัะฝะพะฒะฝะพะน ะะ
sudo ss -tulpn | grep -E '22|80'

# ะััะฝะพะน ะทะฐะฟััะบ ัะตะทะตัะฒะฝะพะณะพ ะบะพะฟะธัะพะฒะฐะฝะธั
sudo ip netns exec vm2 rsync -azhAX -e "ssh -i /home/ubuntu/.ssh/id_ed25519" /etc/ ubuntu@192.168.50.1:/backups/etc/

# ะัะพัะผะพัั ะปะพะณะพะฒ cron-ะทะฐะดะฐัะธ
sudo tail -n 50 /var/log/backup-rsync.log

# ะัะพะฒะตัะบะฐ ะฐััะธะฒะพะฒ
ls -lh /backups/etc/
ls -lh /backups/logs/
```

---

## ๐งฐ ะัะฟะพะปัะทัะตะผัะต ะธะฝััััะผะตะฝัั

| ะะฐัะตะณะพัะธั | ะะฝััััะผะตะฝั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|-------------|------------|
| ะกะตัั | `ip`, `ip netns`, `isc-dhcp-server` | ะกะพะทะดะฐะฝะธะต namespace ะธ DHCP |
| ะะตะทะพะฟะฐัะฝะพััั | `iptables`, `netfilter-persistent` | NAT, Firewall |
| ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต | `rsync`, `ssh` | ะะตัะตะดะฐัะฐ ะดะฐะฝะฝัั ะฟะพ ะบะปััั |
| ะะฒัะพะผะฐัะธะทะฐัะธั | `cron` | ะะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐะฝะธะน |
| ะััะธะฒะธัะพะฒะฐะฝะธะต | `tar`, `gzip` | ะััะธะฒะฐัะธั ะปะพะณะพะฒ |
| ะะตะฑ-ัะตัะฒะธั | `nginx` | ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ |
| ะะพะฝะธัะพัะธะฝะณ | `ss`, `ping` | ะัะพะฒะตัะบะฐ ัะตัะตะฒัั ัะตัะฒะธัะพะฒ |

---

## ๐ง ะคะธะปะพัะพัะธั DevSecOps

> โะะตะทะพะฟะฐัะฝะพััั โ ััะพ ะฝะต ะฝะฐัััะพะนะบะฐ, ะฐ ะบัะปััััะฐ.  
> ะะฒัะพะผะฐัะธะทะฐัะธั โ ะฝะต ัะตะปั, ะฐ ะธะฝััััะผะตะฝั ะฝะฐะดัะถะฝะพััะธ.โ

ะะฐะฝะฝัะน ะฟัะพะตะบั ััะธั ะผััะปะธัั ะบะฐะบ **DevSecOps-ะธะฝะถะตะฝะตั**:

- ะฒัั ะดะพะปะถะฝะพ ะฑััั **ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะพ ะธ ะฒะพัะฟัะพะธะทะฒะพะดะธะผะพ**,  
- ะผะธะฝะธะผะฐะปัะฝัะต ะฟัะฐะฒะฐ ะธ ะพัะบััััะต ะฟะพััั,  
- ะฑะตะทะพะฟะฐัะฝัะน ะดะพัััะฟ โ ัะพะปัะบะพ ะฟะพ ะบะปััะฐะผ,  
- ะผะพะฝะธัะพัะธะฝะณ ะธ ะฐัะดะธั ะบะฐะถะดะพะณะพ ะดะตะนััะฒะธั,  
- ะฝะฐะดัะถะฝัะต ัะตะทะตัะฒะฝัะต ะบะพะฟะธะธ ะธ ะธั ะบะพะฝััะพะปั.  

---

## ๐ฑ ะััะธ ัะฐะทะฒะธัะธั (Roadmap)

ะัะปะธ ัั ะพัะฒะพะธะป ััั ะปะฐะฑะพัะฐัะพัะธั โ ะฒะพั ัะฒะพะธ **ัะปะตะดัััะธะต ััะพะฒะฝะธ ัะพััะฐ**:

### ๐งฉ ะฃัะพะฒะตะฝั 2 โ ะะฐะฑะปัะดะฐะตะผะพััั
- ะฃััะฐะฝะพะฒะธ **Prometheus + Node Exporter** ะดะปั ะผะตััะธะบ.  
- ะะพะฑะฐะฒั **Grafana Loki** ะดะปั ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะณะพ ัะฑะพัะฐ ะปะพะณะพะฒ.  

### ๐ ะฃัะพะฒะตะฝั 3 โ ะะตะทะพะฟะฐัะฝะพััั
- ะะฐัััะพะน **Fail2Ban**, **AppArmor** ะธะปะธ **SELinux**.  
- ะะพะฑะฐะฒั `auditd` ะดะปั ะบะพะฝััะพะปั ะธะทะผะตะฝะตะฝะธะน ะฒ ัะธััะตะผะต.  

### ๐งฌ ะฃัะพะฒะตะฝั 4 โ ะะฒัะพะผะฐัะธะทะฐัะธั ะธ IaC
- ะะตัะตะฟะธัะธ ััะตะฝะฐัะธะน ะฝะฐ **Ansible**.  
- ะัะฟะพะปัะทัะน **Terraform** ั ะปะพะบะฐะปัะฝัะผะธ ะฟัะพะฒะฐะนะดะตัะฐะผะธ.  
- ะัะฝะตัะธ vm2 ะฒ **Docker-ะบะพะฝัะตะนะฝะตั**.  

### โ๏ธ ะฃัะพะฒะตะฝั 5 โ ะะฑะปะฐะบะพ ะธ CI/CD
- ะะฐะทะฒะตัะฝะธ ะฐะฝะฐะปะพะณะธัะฝัั ััะตะดั ะฒ **AWS / Azure / GCP**.  
- ะะฐัััะพะน CI/CD ั **GitHub Actions**.  
- ะกะพััะฐะฝัะน ะฑัะบะฐะฟั ะฒ **S3 / MinIO**.  

---

## ๐งพ ะะธัะตะฝะทะธั

**MIT License** โ ัะฒะพะฑะพะดะฝะพ ะธัะฟะพะปัะทัะน, ะธะทััะฐะน ะธ ะผะพะดะธัะธัะธััะน ะฟัะพะตะบั ะฟะพะด ัะฒะพะธ ะทะฐะดะฐัะธ.  

---

## ๐จโ๐ป ะะฒัะพั

ะกะพะทะดะฐะฝะพ ะธะฝะถะตะฝะตัะพะผ, ะบะพัะพััะน ัะพัะตัะฐะตั **DevOps-ะฟัะฐะบัะธะบะธ** ะธ **ะฑะตะทะพะฟะฐัะฝะพััั ัะธััะตะผ** (DevSecOps mindset).  
ะัะพะตะบั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ ะดะปั ัะตั, ะบัะพ ัะพัะตั:

- ะฟะพะฝะธะผะฐัั ัะฐะฑะพัั ัะตัะตะน ะธ Linux-ะธะฝััะฐััััะบัััั,  
- ะฒะฝะตะดัััั ะฑะตะทะพะฟะฐัะฝัั ะฐะฒัะพะผะฐัะธะทะฐัะธั,  
- ะฟัะพะตะบัะธัะพะฒะฐัั ะพัะบะฐะทะพัััะพะนัะธะฒัะต ัะธััะตะผั ั ะฝัะปั.  

> โะัะปะธ ัั ะผะพะถะตัั ะฟะพัััะพะธัั ะฑะตะทะพะฟะฐัะฝัั ะธะฝััะฐััััะบัััั ะฝะฐ ะพะดะฝะพะน ะะ โ  
> ัั ัะผะพะถะตัั ัะฟัะฐะฒะปััั ะตั ะฒ ะปัะฑะพะน ะพะฑะปะฐัะฝะพะน ััะตะดะต.โ

---

## ๐ฌ ะะพะฝัะฐะบัั ะธ ะฒะบะปะฐะด

Pull Requestโั, ะธะดะตะธ ะธ ัะปัััะตะฝะธั ะฟัะธะฒะตัััะฒััััั!  
ะัะดะตั ะพัะพะฑะตะฝะฝะพ ะธะฝัะตัะตัะฝะพ ะดะพะฑะฐะฒะธัั:
- ัะฐััะธัะตะฝะฝัะต firewall-ะฟัะฐะฒะธะปะฐ,  
- ะฐะฒัะพะผะฐัะธะทะฐัะธั ั systemd timers,  
- ะฟะพะดะดะตัะถะบั ะบะพะฝัะตะนะฝะตัะพะฒ ะธ ะบะปะฐััะตัะพะฒ.

---

# ะะพะผะฐะฝะดั ะดะปั ะฒัะฟะพะปะฝะตะฝะธั ััะพะณะพ ะฟัะพะตะบัะฐ ะฟะพะพัะตัะตะดะฝะพััะธ

``` bash
sudo ip netns add vm2
sudo ip link add veth0 type veth peer name veth1
sudo ip link set veth1 netns vm2

sudo ip addr add 192.168.50.1/24 dev veth0
sudo ip link set veth0 up

sudo ip netns exec vm2 ip link set lo up
sudo ip netns exec vm2 ip link set veth1 up

# PART 1 โ DHCP SERVER

sudo apt update
sudo apt install -y isc-dhcp-server

sudo tee /etc/dhcp/dhcpd.conf <<EOF
default-lease-time 3600;
max-lease-time 7200;
authoritative;

subnet 192.168.50.0 netmask 255.255.255.0 {
    range 192.168.50.100 192.168.50.200;
    option routers 192.168.50.1;
    option domain-name-servers 8.8.8.8, 1.1.1.1;
}
EOF

sudo sed -i 's|INTERFACESv4=""|INTERFACESv4="veth0"|' /etc/default/isc-dhcp-server
sudo systemctl restart isc-dhcp-server
sudo systemctl enable isc-dhcp-server

sudo ip netns exec vm2 dhclient veth1
sudo ip netns exec vm2 ip a

# PART 2 โ NAT + INTERNET

sudo sysctl -w net.ipv4.ip_forward=1

sudo apt install -y iptables iptables-persistent

sudo iptables -t nat -A POSTROUTING -s 192.168.50.0/24 -o end33 -j MASQUERADE
sudo iptables -A FORWARD -i end33 -o veth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i veth0 -o end33 -j ACCEPT

sudo netfilter-persistent save

# PART 3 โ FIREWALL (iptables, no ufw)

sudo iptables -F INPUT
sudo iptables -P INPUT DROP
sudo iptables -P OUTPUT ACCEPT

sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT

sudo netfilter-persistent save

# PART 4 โ SSH KEYS (vm2 -> main)

sudo ip netns exec vm2 mkdir -p /home/ubuntu/.ssh
sudo ip netns exec vm2 ssh-keygen -t ed25519 -f /home/ubuntu/.ssh/id_ed25519 -N ""
sudo ip netns exec vm2 ssh-keyscan 192.168.50.1 >> /home/ubuntu/.ssh/known_hosts

# copy key to main vm
sudo ip netns exec vm2 ssh-copy-id -i /home/ubuntu/.ssh/id_ed25519.pub ubuntu@192.168.50.1

# PART 5 โ NGINX (service check)

sudo apt install -y nginx
sudo systemctl enable --now nginx

# PART 6 โ BACKUP VIA RSYNC

sudo mkdir -p /backups/etc
sudo chown ubuntu:ubuntu /backups/etc

sudo ip netns exec vm2 rsync -azhAX -e "ssh -i /home/ubuntu/.ssh/id_ed25519" \
/etc/ ubuntu@192.168.50.1:/backups/etc/

# PART 7 โ CRON

( sudo crontab -l 2>/dev/null; echo \
'0 2 * * * /usr/bin/rsync -azhAX --delete /etc/ /backups/etc/ >> /var/log/backup-rsync.log 2>&1' ) \
| sudo crontab -

# PART 8 โ TAR LOG ARCHIVES

sudo mkdir -p /backups/logs
sudo tar -czvf /backups/logs/logs_$(date +%F).tar.gz /var/log

# PART 9 โ CHECKS

sudo ip netns exec vm2 ping -c 2 8.8.8.8
sudo ss -tulpn | grep -E '22|80'
ls -lh /backups/etc/
ls -lh /backups/logs/
sudo ip netns exec vm2 ssh ubuntu@192.168.50.1 "hostname"

```

โ **ะขะตััะธัะพะฒะฐะฝะพ:** Ubuntu 25.10  
โ **ะกะพััะพัะฝะธะต:** ะกัะฐะฑะธะปัะฝะฐั ะฒะตััะธั  
โ **ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฐะบัะธัะตัะบะฐั DevSecOps-ะปะฐะฑะพัะฐัะพัะธั  
โ **ะกะปะตะดัััะธะน ัะฐะณ:** ะะฒัะพะผะฐัะธะทะฐัะธั ัะตัะตะท Ansible  
